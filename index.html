<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>eGeoffrey</title>
    
    <!-- jQuery -->
    <script src="lib/jquery/jquery.min.js"></script>
    
    <!-- jQuery-ui -->
    <script src="lib/jquery-ui/jquery-ui.min.js"></script>

    <!-- Bootstrap -->
    <script src="lib/bootstrap/bootstrap.bundle.min.js"></script>

    <!-- overlayScrollbars -->
    <script src="lib/overlayScrollbars/jquery.overlayScrollbars.min.js"></script>
    <link rel="stylesheet" href="lib/overlayScrollbars/OverlayScrollbars.min.css">

    <!-- AdminLTE (theme) -->
    <script src="lib/adminlte/adminlte.js"></script>
    <link rel="stylesheet" href="lib/adminlte/adminlte.css">
    
    <!-- Fonts -->
    <link href="lib/fonts/fonts.css" rel="stylesheet">

    <!-- Font Awesome (icons) -->
    <link rel="stylesheet" href="lib/fontawesome/css/all.min.css">

    <!-- Toastr (notify) -->
    <script src="lib/toastr/toastr.min.js"></script>
    <link rel="stylesheet" href="lib/toastr/toastr.min.css">

    <!-- MQTT (gateway) -->
    <script src="lib/mqtt/mqttws31.min.js"></script>

    <!-- FastClick (speed up clicks) -->
    <script src="lib/fastclick/fastclick.js"></script>

    <!--  Touchspin (numeric input box with +/-) -->
    <script src="lib/touchspin/touchspin.min.js"></script>
    <link rel="stylesheet" href="lib/touchspin/touchspin.min.css" />

    <!-- BoootstrapToggle (checkbox with toggle button) -->
    <link href="lib/bootstrap-toggle/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="lib/bootstrap-toggle/bootstrap-toggle.min.js"></script>

    <!-- iCheck (large checkbox) -->
    <script src="lib/icheck/icheck.min.js"></script>
    <link rel="stylesheet" href="lib/icheck/square/blue.css" />

    <!-- CodeMirror (yaml code editor) -->
    <script src="lib/codemirror/codemirror.js"></script>
    <link rel="stylesheet" href="lib/codemirror/codemirror.css" />
    <script src="lib/codemirror/yaml.js"></script>

    <!-- Bootbox (confirm modal) -->
    <script src="lib/bootbox/bootbox.all.min.js"></script>

    <!-- DataTables (tables) -->
    <link rel="stylesheet" href="lib/datatables/datatables.min.css" />
    <script src="lib/datatables/datatables.min.js"></script>
    <script src="lib/datatables/dataTables.colResize.js"></script>

    <!--  dhtmlxscheduler (scheduler calendar) -->
    <script src="lib/dhtmlxscheduler/dhtmlxscheduler.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_recurring.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_serialize.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_quick_info.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_key_nav.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_collision.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_minical.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_limit.js"></script>
    <script src="lib/dhtmlxscheduler/ext/dhtmlxscheduler_responsive.js"></script>
    <link rel="stylesheet" href="lib/dhtmlxscheduler/dhtmlxscheduler_flat.css" />
    <link rel="stylesheet" href="lib/dhtmlxscheduler/ext/dhtmlxscheduler_responsive.css" />

    <!--  Highstock (charts) -->
    <script src="lib/highstock/highstock.js"></script>
    <script src="lib/highstock/highcharts-more.js"></script>
    <script src="lib/highstock/modules/exporting.js"></script>
    <script src="lib/highstock/modules/offline-exporting.js"></script>

    <!--  js-yaml (yaml encoder/decoder) -->
    <script src="lib/js-yaml/js-yaml.min.js"></script>

    <!--  eGeoffrey -->
    <script src="sdk/javascript/constants.js"></script>
    <script src="sdk/javascript/utils/strings.js"></script>
    <script src="sdk/javascript/utils/datetimeutils.js"></script>
    <script src="sdk/javascript/module/helpers/session.js"></script>
    <script src="sdk/javascript/module/helpers/message.js"></script>
    <script src="sdk/javascript/module/helpers/mqtt_client.js"></script>
    <script src="sdk/javascript/module/module.js"></script>

    <script src="gui/gui.js"></script>
    <script src="gui/widget.js"></script>
    <script src="gui/menu.js"></script>
    <script src="gui/toolbar.js"></script>
    <script src="gui/page.js"></script>

    <script src="gui/widgets/user/summary.js"></script>
    <script src="gui/widgets/user/timeline.js"></script>
    <script src="gui/widgets/user/range.js"></script>
    <script src="gui/widgets/user/calendar.js"></script>
    <script src="gui/widgets/user/value.js"></script>
    <script src="gui/widgets/user/images.js"></script>
    <script src="gui/widgets/user/maps.js"></script>
    <script src="gui/widgets/user/text.js"></script>
    <script src="gui/widgets/user/table.js"></script>
    <script src="gui/widgets/user/counter.js"></script>
    <script src="gui/widgets/user/tasks.js"></script>

    <script src="gui/widgets/system/modules.js"></script>
    <script src="gui/widgets/system/sensors.js"></script>
    <script src="gui/widgets/system/logs.js"></script>
    <script src="gui/widgets/system/rules.js"></script>
    <script src="gui/widgets/system/chatbot.js"></script>
    <script src="gui/widgets/system/configuration.js"></script>
    <script src="gui/widgets/system/icons.js"></script>
    <script src="gui/widgets/system/packages.js"></script>
    <script src="gui/widgets/system/database.js"></script>
    <script src="gui/widgets/system/gateway.js"></script>
    <script src="gui/widgets/system/notifications.js"></script>
    <script src="gui/widgets/system/sensor_wizard.js"></script>
    <script src="gui/widgets/system/marketplace.js"></script>
</head>

<style>
    th.dt-center,
    td.dt-center {
        text-align: center;
    }
    
    .center-block {
        float: none !important
    }
    
    .col-centered {
        margin: 0 auto;
        float: none;
    }
    
    .modal-content {
        height: auto;
        border-radius: 0;
    }
    
    .direct-chat-messages {
        height: 365px;
    }
</style>

<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">
        
        <!-- ### TOP BAR ### -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-sm-inline-block">
                    <b><a id="house_name" class=" nav-link brand-text"></a></b>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a class="nav-link">|</a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a id="house_time" class=" nav-link"></a>
                </li>
            </ul>

            <!-- ### TOP-RIGHT TOOLBAR ### -->
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="fas fa-ban"></i>
                        <span class="badge badge-danger navbar-badge" id="notification_alert_count"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" id="notification_alert">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item dropdown-footer" id="notification_alert_link">View all</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="badge badge-warning navbar-badge" id="notification_warning_count"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" id="notification_warning">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item dropdown-footer" id="notification_warning_link">View all</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="fas fa-info"></i>
                        <span class="badge badge-success navbar-badge" id="notification_info_count"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" id="notification_info">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item dropdown-footer" id="notification_info_link">View all</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <input type="checkbox" id="notification_value_enabled">
                        <i class="fas fa-microchip"></i>
                        <span class="badge badge-info navbar-badge" id="notification_value_count"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" id="notification_value">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item dropdown-footer" id="notification_value_link">View all</a>
                    </div>
                </li>

                <li class="nav-item d-none">
                    <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#"><i
            class="fas fa-th-large"></i></a>
                </li>
            </ul>
        </nav>

        <!-- ### TOP-LEFT LOGO ### -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <a href="#" class="brand-link">
                <i class="brand-image fas fa-concierge-bell"></i>
                <span class="brand-text font-weight-light">e<b>Geoffrey</b></span>
            </a>

            <!-- ### LEFT MENU ### -->
            <div class="sidebar">
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <button type="button" class="btn btn-tool bg-info"><i id="user_icon" class="fas"></i></button>
                    <div class="pull-left info">
                        <a id="user_fullname" class="d-block"></a>
                        <a id="status" href="#" class="d-block"><i class="fa fa-circle text-red"></i></a>
                    </div>
                </div>

                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false" id="menu">
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- ### PAGE CONTENT  ### -->
        <div class="content-wrapper">
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1 class="m-0 text-dark" id="title"></h1>
                        </div>
                    </div>
                </div>
            </div>
            <section class="content">
                <div class="container-fluid">
                    <div id="body"></div>
                    <div style="padding: 10px 0px; text-align: center;">
                        <div class="text-muted"><a href="javascript:window.scrollTo(0,0);">Go to Top</a></div>
                    </div>

                </div>
            </section>
        </div>

        <!-- =============================================== -->

        <!-- ### GENERIC POPUP  ### -->
        <div class="modal fade modal-fullscreen force-fullscreen" id="popup">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12 center-block" id="popup_body"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary pull-rigth" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ### WIZARD POPUP  ### -->
        <div class="modal fade" id="wizard">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="wizard_title"></h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12 center-block" id="wizard_body"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary pull-rigth" id="wizard_save">Save</button>
                        <button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ### LOGIN POPUP  ### -->
        <div class="modal fade" id="login">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-body login-page">
                        <div class="login-box">
                            <div class="login-logo text-primary">
                                e<b>Geoffrey</b>
                            </div>
                            <div class="login-box-body">
                                <p class="login-box-msg">Welcome to eGeoffrey!</p>
                                <form>
                                    <div class="card card-primary">
                                        <div class="card-header with-border">
                                            <h3 class="card-title">Gateway</h3>

                                            <div class="card-tools pull-right">
                                                <button type="button" class="btn btn-card-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="form-group has-feedback">
                                                <input type="input" class="form-control" placeholder="eGeoffrey Gateway" id="egeoffrey_gateway_hostname">
                                            </div>
                                            <div class="form-group has-feedback">
                                                <input type="input" class="form-control" placeholder="Port" id="egeoffrey_gateway_port">
                                            </div>
                                            <div class="form-group has-feedback">
                                                <div class="checkbox icheck">
                                                    <label>
                                                        <input type="checkbox" id="egeoffrey_gateway_ssl"> Use SSL
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card card-primary">
                                        <div class="card-header with-border">
                                            <h3 class="card-title">House</h3>

                                            <div class="card-tools pull-right">
                                                <button type="button" class="btn btn-card-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="form-group has-feedback">
                                                <input type="input" class="form-control" placeholder="House ID" id="egeoffrey_id">
                                            </div>
                                            <div class="form-group has-feedback">
                                                <input type="password" class="form-control" placeholder="Passcode" id="egeoffrey_passcode">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card card-primary">
                                        <div class="card-header with-border">
                                            <h3 class="card-title">User</h3>

                                            <div class="card-tools pull-right">
                                                <button type="button" class="btn btn-card-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="form-group has-feedback">
                                                <input type="input" class="form-control" placeholder="Username" id="egeoffrey_username">
                                            </div>
                                            <div class="form-group has-feedback">
                                                <input type="password" class="form-control" placeholder="Password" id="egeoffrey_password">
                                            </div>
                                        </div>
                                    </div>
                                    <center>
                                        <p class="text-red" id="login_error"></p>
                                    </center>
                                    <div class="form-group has-feedback">
                                        <div class="checkbox icheck">
                                            <label>
                                                <input type="checkbox" id="egeoffrey_remember_me"> Remember Me
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group has-feedback">
                                        <button type="button" class="btn btn-primary btn-block btn-flat" id="login_button">Login</button>
                                    </div>
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ### CONTROL-SIDEBAR  ### -->
    <aside class="control-sidebar control-sidebar-dark">
    </aside>

    <!-- ### FOOTER  ### -->
    <footer class="main-footer">
        <strong>Copyright &copy; 2019 <a href="http://egeoffrey.github.io" target="_new">eGeoffrey</a>.
			</strong> All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
            <b>Version</b> <span id="version"></span>
        </div>
    </footer>
    </div>

    <script type="text/javascript">
        // override default configuration
        window.EGEOFFREY_DEBUG = 0
        window.EGEOFFREY_GATEWAY_HOSTNAME = window.location.hostname
        window.EGEOFFREY_GATEWAY_PORT = 443
        window.EGEOFFREY_LOGGING_LOCAL = true

        // set to true when the login button is pressed
        var login_submit = false

        // setup checkboxes
        $(":checkbox").iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%'
        });

        // generate a random session_id
        function generate_session_id() {
            var min = 1;
            var max = 100000;
            return Math.floor(Math.random() * (+max - +min)) + +min;
        }

        // configure login button
        $("#login_button").unbind().click(function() {
            return function() {
                // disable the login button
                $("#login_button").prop("disabled", true)
                $("#login_button").html("Connecting...")
                $("#login_error").html("")
                    // pull out the user's data and set the variables
                window.EGEOFFREY_GATEWAY_HOSTNAME = $("#egeoffrey_gateway_hostname").val()
                window.EGEOFFREY_GATEWAY_PORT = $("#egeoffrey_gateway_port").val()
                window.EGEOFFREY_GATEWAY_SSL = $("#egeoffrey_gateway_ssl").is(":checked")
                window.EGEOFFREY_ID = $("#egeoffrey_id").val()
                window.EGEOFFREY_PASSCODE = $("#egeoffrey_passcode").val()
                window.EGEOFFREY_USERNAME = $("#egeoffrey_username").val()
                window.EGEOFFREY_PASSWORD = $("#egeoffrey_password").val()
                window.EGEOFFREY_REMEMBER_ME = $("#egeoffrey_remember_me").is(":checked")
                    // create a new instance of the gui and run it
                window.gui = new Gui("gui", EGEOFFREY_USERNAME + "_" + generate_session_id())
                window.gui.run()
                login_submit = true
            };
        }());

        // upon loading, build and run the GUI
        $(document).ready(function() {
            // restore user credentials 
            if (localStorage.getItem("EGEOFFREY_GATEWAY_HOSTNAME") != null) window.EGEOFFREY_GATEWAY_HOSTNAME = localStorage.getItem("EGEOFFREY_GATEWAY_HOSTNAME")
            if (localStorage.getItem("EGEOFFREY_GATEWAY_PORT") != null) window.EGEOFFREY_GATEWAY_PORT = localStorage.getItem("EGEOFFREY_GATEWAY_PORT")
            if (localStorage.getItem("EGEOFFREY_GATEWAY_SSL") != null) window.EGEOFFREY_GATEWAY_SSL = Boolean(parseInt(localStorage.getItem("EGEOFFREY_GATEWAY_SSL")))
            if (localStorage.getItem("EGEOFFREY_ID") != null) window.EGEOFFREY_ID = localStorage.getItem("EGEOFFREY_ID")
            if (localStorage.getItem("EGEOFFREY_PASSCODE") != null) window.EGEOFFREY_PASSCODE = localStorage.getItem("EGEOFFREY_PASSCODE")
            if (localStorage.getItem("EGEOFFREY_USERNAME") != null) window.EGEOFFREY_USERNAME = localStorage.getItem("EGEOFFREY_USERNAME")
            if (localStorage.getItem("EGEOFFREY_PASSWORD") != null) window.EGEOFFREY_PASSWORD = localStorage.getItem("EGEOFFREY_PASSWORD")
            if (localStorage.getItem("EGEOFFREY_REMEMBER_ME") != null) window.EGEOFFREY_REMEMBER_ME = Boolean(parseInt(localStorage.getItem("EGEOFFREY_REMEMBER_ME")))
                // create a gui and start it
            window.gui = new Gui("gui", "guest_" + generate_session_id())
            window.gui.run()
        });

        // periodically check if the connection is established, otherwise show login page
        var watchdog = setInterval(function() {
            $("#login_button").prop("disabled", false)
            $("#login_button").html("Login")
            var login_screen = $('#login').is(':visible');
            // when the login screen is shown
            if (login_screen) {
                // check if connected and if so hide the login screen
                if (window.gui.connected) {
                    // connected
                    $("#login_error").html("")
                        // remember user credentials if requested
                    if ($("#egeoffrey_remember_me").is(":checked")) {
                        localStorage.setItem("EGEOFFREY_GATEWAY_HOSTNAME", window.EGEOFFREY_GATEWAY_HOSTNAME)
                        localStorage.setItem("EGEOFFREY_GATEWAY_PORT", window.EGEOFFREY_GATEWAY_PORT)
                        localStorage.setItem("EGEOFFREY_GATEWAY_SSL", window.EGEOFFREY_GATEWAY_SSL)
                        localStorage.setItem("EGEOFFREY_ID", window.EGEOFFREY_ID)
                        localStorage.setItem("EGEOFFREY_PASSCODE", window.EGEOFFREY_PASSCODE)
                        localStorage.setItem("EGEOFFREY_USERNAME", window.EGEOFFREY_USERNAME)
                        localStorage.setItem("EGEOFFREY_PASSWORD", window.EGEOFFREY_PASSWORD)
                        localStorage.setItem("EGEOFFREY_REMEMBER_ME", window.EGEOFFREY_REMEMBER_ME)
                    } else localStorage.clear()
                    $("#login").modal("hide")
                    login_submit = false
                } else {
                    if (login_submit) $("#login_error").html("ERROR: Unable to connect or invalid credentials")
                    login_submit = false
                }
            }
            // already logged in, ensure we are still connected
            else {
                if (!window.gui.connected) {
                    // not connected, stop the current instance of the gui from connecting
                    window.gui.join()
                        // set login information from previous settings
                    $("#egeoffrey_gateway_hostname").val(gui.gateway_hostname)
                    $("#egeoffrey_gateway_port").val(gui.gateway_port)
                    if (gui.gateway_ssl) $("#egeoffrey_gateway_ssl").iCheck('check')
                    else $("#egeoffrey_gateway_ssl").iCheck('uncheck')
                    $("#egeoffrey_id").val(gui.house_id)
                    $("#egeoffrey_passcode").val(gui.house_passcode)
                    $("#egeoffrey_username").val(gui.username)
                    $("#egeoffrey_password").val(gui.password)
                        // show up the login screen
                    $("#login").modal()
                }
            }
        }, 2000);
    </script>
</body>

</html>